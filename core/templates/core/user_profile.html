{% extends 'base.html' %}

{% block content %}

<div class='grid-container profile-wrapper'>
        <div class="profile">
                        <h4>Welcome {{user.person.first_name}}</h4>
                        <p>Username: {{user}}</p>
                        <p>Email: <a href="">{{user.person.email_address}}</a></p> 
                        {% for pair in user.person.pairs %}
                           {% if user.person.role == 'mentor' %}
                        <p>Click your mentee's profile: <a href="{% url 'profile' user_id=pair.mentee.id %}" title="Profile" target="_blank">{{pair.mentee}}</a></p>
                         {% else %}
                        <p>Click to view your mentor's profile: <a href="{% url 'profile' user_id=pair.mentor.id %}" title="Profile" target="_blank">{{pair.mentor}}</a></p>
                        {% endif %}
                        {% endfor %}
                
                       <p>{{user.person.first_name}}'s Interests:
                        {% for category in user.person.categories.all %}
                        {{ category }}
                        {% if not forloop.last %},{% endif %}
                        {% endfor %}</p>
                
        </div>

        <div class="goals-list">
               <h3> {{user.person.first_name | title}}'s goals:</h3>
               
               {% for goal in goals_by_user %}

                <details>
                  
                {% if goal.completed %}

                <summary>{{goal.description}} <input type="checkbox" checked=checked class='goal-done-checkbox' data-goal='{{goal.pk}}'/></summary>

<!-- Canvas for goal tracker -->
<div>
<canvas id="myChart" width="400" height="100"></canvas>
<script>
var ctx = document.getElementById('myChart').getContext('2d');
var myChart = new Chart(ctx, {
    type: 'horizontalBar',
    data: {
        labels: ['Goal 1', 'Goal 2', 'Goal 3', 'Goal 4', 'Goal 5', 'Goal 6'],
        datasets: [{
            label: '% of goal completed',
            data: [12, 19, 3, 5, 2, 3],
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true
                }
            }]
        }
    }
});
</script>

</div>


<h4 class="title">Add a goal</h4>
<form id='new_goal' class='new_goal' method='post' action="{% url 'add_goal' %}">{% csrf_token %}
        <textarea required type='text' class="newGoal" placeholder='Add Goal'></textarea>
        <button type="submit"> Submit </button>
</form>

                {% for step in goal.steps.all %} 
{% comment %}
Merge and Check Lines 84-90                 
{% endcomment %}

                <p>{{ step }}</p>

                {% endfor %}

                {% else %}
                <summary>{{goal.description}} <input type="checkbox"class='goal-done-checkbox' data-goal='{{goal.pk}}'/></summary> 
                {% for step in goal.steps.all %}  
                <p>
                        {% if step.done %}
                        <input type="checkbox" checked=checked class='step-done-checkbox' data-step='{{step.pk}}'/>
                        {% else %}
                        <input type="checkbox" class='step-done-checkbox' data-step='{{step.pk}}'/>
                        {% endif %}
                        {{ step }} 
                </p>
                {% endfor %}

                <form class='new_step' method='post' data-goal='{{goal.pk}}' action="{% url 'add_step' goal.pk %}">{% csrf_token %}
                <input required type='text' class="newStep" placeholder='Add Step'></input>
                <button type="step-submit-button"> Submit </button>
                </form>
                {% endif %}
                                        

                </details>
                 
                {% endfor %} 
        </div>
                
                <div class='add-goal'>
                        <form id='new_goal' class='new_goal' method='post' action="{% url 'add_goal' %}">{% csrf_token %}
                                <input required type='text' class="newGoal" placeholder='Add a new goal'></input>
                                <button class='goal-submit-button' type="submit"> Submit </button>
                        </form>
              </div>


        <div class="chat-board card">

       
                {% for chatroom in chatrooms %}
                {% for pair in user.person.pairs %}
                {% if pair == chatroom.pair %}
                <div class="column">
                                <h3><center>Access Chatroom:</center></h3>
                                <div class="buttons index-buttons"><a href="/chatrooms/{{chatroom.slug}}">Mentor/Mentee Chatroom</a></div>
                        {% endif %}
                        {% endfor %}
                        </div>
                        </div>
                </div>
                {% endfor %}
               

        </div>


        {% if request.user.is_superuser or request.user.is_admin %}
                <div class="admin-functionality card clear">
                        <h3><center>Administration: </center></h3>
                        <div class="buttons index-buttons"><a  href="{% url 'create_pair' %}" title="Match Mentors:Mentees">Match Mentors/Mentees</a></div>
                </div>
        {% endif %}



</div>

{% endblock %}

